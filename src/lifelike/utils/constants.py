import numpy as np


# Constants for terrain perception
def compute_terrain_rectangle(x_min, x_max, x_num, y_min, y_max, y_num):
    res = np.zeros((x_num, y_num, 3))
    for i, ix in enumerate(np.linspace(x_min, x_max, x_num)):
        for j, jy in enumerate(np.linspace(y_min, y_max, y_num)):
            res[i, j] = [ix, jy, 0]
    return res  # (x_num, y_num, 3)


def compute_terrain_concentric_circle(circle_radious, point_num):
    circle_around_x = []
    circle_around_y = []
    for radii in circle_radious:
        for i in range(point_num):
            x = radii * np.cos(i * 2 * np.pi / point_num)
            y = radii * np.sin(i * 2 * np.pi / point_num)
            circle_around_x.append(x)
            circle_around_y.append(y)
    return np.array([circle_around_x, circle_around_y])


# v1 version rectangle 1D vector
rectangle_v1 = compute_terrain_rectangle(0, 0.5, 20, -0.3, 0.3, 20)
TERRAIN_RECTANGLE_V1 = rectangle_v1.reshape((-1, 3))
# v2 version rectangle 2D array
TERRAIN_RECTANGLE_V2 = compute_terrain_rectangle(-0.5, 0.5, 32, -0.3, 0.3, 16)
# v3 version rectangle 2D array with denser points in x direction
TERRAIN_RECTANGLE_V3 = compute_terrain_rectangle(-0.5, 0.5, 64, -0.3, 0.3, 16)
# Concentric circle in 1D vector
TERRAIN_CONCENTRIC_CIRCLE = compute_terrain_concentric_circle(circle_radious=[0.06, 0.1, 0.15], point_num=12)

STATES_INFO = {
    'base_pos': [0.0, 0.0, 0.32933522877792815],
    'base_orn': [0.0445309744469853, 0.03982910276804652, -0.0017768054357250303, 0.9982121407045388],
    'base_lin_vel': [0.0055988811750573575, -0.010582406040380299, -0.009141044516525199],
    'base_ang_vel': [-0.11677877004412063, -0.046477796768883875, 0.11095046061117295],
    'joint_pos': [-0.09000504951916015, -0.7924270686467008, 1.780773589254496, -0.08832508474649438,
                  -0.7897708642492078, 1.7699584347251869, -0.08992069031766482, -0.7088595540465088,
                  1.5821145355628536, -0.08840841253513806, -0.7052121698435694, 1.5700905660926956],
    'joint_vel': [0.08217429952386168, -0.05629116195749795, -0.06005541369336065, 0.08638100886602107,
                  -0.04588832355767458, -0.009600158650595603, 0.2080554115555544, -0.14583006237058882,
                  0.1291326540054527, 0.22852208458538692, -0.06473143700810091, 0.0240524382081464]
}

MOCAP_STATES_INFO = {
    'base_pos': [0, 0, 0.34482160631294795],
    'base_orn': (-0.02293682, -0.01105774, -0.07126605,  0.99713228),
    'base_lin_vel': (-0.11095864783443266, 0.0006344526804724637, 0.0040512208403287175),
    'base_ang_vel': (-0.04245558106700246, 0.0024646233381269067, -0.020870770880733153),
    'joint_pos': [0.11271762840009182, -1.0109037286447378, 1.568045082672247, 0.09100907157560624,
                  -1.0251911092594443, 1.5119653429692193, 0.014396496079970721, -0.8625831764605947,
                  1.6016914752522506, -0.022549734989626015, -1.0552199212284616, 1.6549892866443332],
    'joint_vel': [0.052941200870713634, -0.014568989069045912, -0.04317992705036744, 0.015856160871466907,
                  0.019005410449679516, -0.09293905369668565, 0.006326918755665822, -0.06036264660058244,
                  0.04131442191216195, 0.0066474978776213944, -0.05239696559537599, 0.020659484313796384]
}

GAZEBO_STATES_INFO = {
    'base_pos': [0, 0, 0.34482160631294795],
    'base_orn': (-0.02293682, -0.01105774, -0.07126605,  0.99713228),
    'base_lin_vel': (0, 0, 0),
    'base_ang_vel': (0, 0, 0),
    'joint_pos': [-0.0041868, -0.953189, 1.70106,
                  0.00419342, -0.953497, 1.70117,
                  -8.85071e-05, -0.922433, 1.72419,
                  0.000328144, -0.922476, 1.72419],
    'joint_vel': [0] * 12
}

STATES_INFO_16 = {
    'base_pos': [0.00524782626250792, -0.013205421638408476, 0.3256641507346318],
    'base_orn': [-0.04000999864789469, 0.009429702084884006, 0.9365034271335525, 0.34824073813081763],
    'base_lin_vel': [-0.04260070397902702, -0.04755678219709008, -0.02535306976755204],
    'base_ang_vel': [0.09756405757834247, -0.0533372903620135, -0.21314841451473138],
    'joint_pos': [-0.013775724067520988, -1.0194521968264676, 1.7051575075318157, 0.0,
                  0.07536891214338363, -0.9616317449276035, 1.7029120814276812, 0.0,
                  -0.1745834076354872, -0.7874384852853687, 1.3833294240247753, 0.0,
                  0.1284892712961621, -0.8065058178673086, 1.4639904896021092, 0.0, ],
    'joint_vel': [-0.01111031657357986, 0.04266004569760229, 0.050508435846395194, 0.0,
                  0.008295406423559026, -0.2743620133033924, 0.2018664058154398, 0.0,
                  -0.23021513403470042, 0.19003257788751615, -0.15689699432029158, 0.0,
                  -0.21121191848678614, -0.44074243675463487, 0.4956699541032785, 0.0]
}

STATES_INFO_12 = {
    'base_pos': [0.00524782626250792, -0.013205421638408476, 0.3256641507346318],
    'base_orn': [-0.04000999864789469, 0.009429702084884006, 0.9365034271335525, 0.34824073813081763],
    'base_lin_vel': [-0.04260070397902702, -0.04755678219709008, -0.02535306976755204],
    'base_ang_vel': [0.09756405757834247, -0.0533372903620135, -0.21314841451473138],
    'joint_pos': [-0.013775724067520988, -1.0194521968264676, 1.7051575075318157,
                  0.07536891214338363, -0.9616317449276035, 1.7029120814276812,
                  -0.1745834076354872, -0.7874384852853687, 1.3833294240247753,
                  0.1284892712961621, -0.8065058178673086, 1.4639904896021092],
    'joint_vel': [-0.01111031657357986, 0.04266004569760229, 0.050508435846395194,
                  0.008295406423559026, -0.2743620133033924, 0.2018664058154398,
                  -0.23021513403470042, 0.19003257788751615, -0.15689699432029158,
                  -0.21121191848678614, -0.44074243675463487, 0.4956699541032785]
}

STATES_INFO_12_RUN_0 = {
    'base_pos': [0.0, 0.0, 0.3343530097022097],
    'base_orn': [0.013840790797843786, 0.023505515131419717, -0.0003254560394373679, 0.9996278394216837],
    'base_lin_vel': [0.00809597744709567, -0.020893862693440735, -0.001824006727717542],
    'base_ang_vel': [0.0838167925768054, -0.00447012899185979, 0.04114855957667429],
    'joint_pos': [-0.02776715425087109, -0.7790427096234822, 1.687309016042587,
                  -0.02761322597239251, -0.7777310768160954, 1.6837882482054838,
                  -0.02776264511056588, -0.7333994876717276, 1.5669191826863689,
                  -0.027617718742577027, -0.7319111056361625, 1.5631584243808343],
    'joint_vel': [-0.05228733284239881, -0.0686649273790696, 0.05668137846569721,
                  -0.03640328999561543, -0.02286152438035316, 0.0029650694829541635,
                  0.010717179495497164, -0.09457474021233203, 0.10883376594280847,
                  0.023988549884502025, -0.055563832783516176, 0.03375014202679161]
}

STATES_INFO_12_RUN_16 = {
    'base_pos': [-0.0008083460701528715, 0.005777032511568762, 0.32168438603383626],
    'base_orn': [0.018295093385654167, 0.021068437940924695, -0.014751683619642693, 0.9995017750415082],
    'base_lin_vel': [0.0846724716899763, 0.025671842058367103, -0.016796026107673875],
    'base_ang_vel': [-0.039192546538711494, 0.03893597802248091, -0.09915148603961692],
    'joint_pos': [-0.04532286178010996, -0.7942350685058146, 1.7353250069876536,
                  -0.040161611044438154, -0.7857059473064969, 1.7172251535567318,
                  -0.0577867782865416, -0.7549680625940508, 1.630294590579354,
                  -0.07464848978474062, -0.7885306669720744, 1.639602895802183],
    'joint_vel': [0.014711362504335856, -0.2597018655033492, 0.14514754737837965,
                  0.014679526877805993, -0.39173986039712244, 0.2174977579032853,
                  -0.10428007951769869, -0.16035366748871016, -0.018224577425916877,
                  -0.07882562847470076, -0.3359366059421409, 0.14939056170195464]
}

STATES_INFO_12_RUN_60 = {
    'base_pos': [0.009182917012991915, 0.0033760233148777278, 0.32260240132198476],
    'base_orn': [0.019712721597395, 0.015247113894945423, -0.02148736906059767, 0.999458466918937],
    'base_lin_vel': [0.009606783316178247, -0.022442815877775822, 0.022154959039327043],
    'base_ang_vel': [0.06955310753697061, -0.04164419297272896, -0.017474407634303392],
    'joint_pos': [-0.03317443337698642, -0.8287107530922164, 1.7309873479006115,
                  -0.04284440975290537, -0.8553998887759476, 1.7062061973746618,
                  -0.13421047555426854, -0.37085851930029784, 1.4483390715510254,
                  -0.07996889052929664, -0.8424392768572886, 1.6512433794350492],
    'joint_vel': [0.007297165808979156, -0.008040453071366638, -0.10072283910391455,
                  0.0074260823390710495, 0.0575114884979, -0.23603399863885421,
                  -0.004614067672873992, -0.06205238117069667, 0.006879483916328866,
                  -0.01109825071079762, 0.0028406771605515857, -0.13598811587704063]
}

STATES_INFO_12_RUN_132 = {
    'base_pos': [0.2798518910860718, -0.01661360482648053, 0.2807201426251027],
    'base_orn': [0.0021063495738928638, 0.0207229998357091, -0.027827538570109264, 0.9993956917389683],
    'base_lin_vel': [1.1094450688369044, 0.08242137305284607, -0.025445068856219076],
    'base_ang_vel': [-0.6692553849667384, -0.6200731124093705, -0.4254735804064325],
    'joint_pos': [-0.003672395732424575, -1.0932639147464407, 1.9622448053263295,
                  -0.07573126625194353, -0.9337418681929203, 2.2451095607466196,
                  -0.14607173791822098, -0.7846192775215882, 2.0336281125888,
                  0.003740560032992229, -0.8748839474659286, 1.8648571202795916],
    'joint_vel': [0.3704780385094939, -3.6923982512680116, -1.1413321470459152,
                  -3.0301464634670445, 3.8125698674591573, 0.5627808004890611, 1.4633443353285247,
                  11.482094994505163, 3.089664912236629, -0.15616909835561943, -5.801863898041658,
                  2.1288449320152445]
}

MAX6_INIT = {
    'base_pos': [0.0, 0.0, 0.28184],
    'base_orn': [-0.00191, -0.00836, -0.05595, 0.99840],
    'base_lin_vel': [0.0, 0.0, 0.0],
    'base_ang_vel': [0.0, 0.0, 0.0],
    'joint_pos': [-0.00024, -1.09106, 1.81882,
                  -0.01088, -1.07725, 1.80387,
                  0.01203, -1.05923, 1.82930,
                  0.00024, -1.07840, 1.83582],
    'joint_vel': [0.0] * 12
}

LEG_NAMES = ['FR', 'FL', 'HR', 'HL']
LEG_JOINT_NAMES = [f'joint_{leg}{j}' for leg in LEG_NAMES for j in [1, 2, 3]]
SHANK_JOINT_NAMES = [f'joint_{leg}3' for leg in LEG_NAMES]
FOOT_JOINT_NAMES = [f'joint_{leg}4' for leg in LEG_NAMES]
WHEEL_JOINT_NAMES = [f'joint_{leg}W' for leg in LEG_NAMES]
HANDLE_JOINT_NAMES = ['joint_front_handle', 'joint_hind_handle']
